---
show: step
version: 1.0
enable_checker: true
---

# HTTP 网络编程实现

## 实验介绍

本实验主要介绍基于 Go 语言如何用 Socket 编程知识实现并发通讯服务的案例，从而让大家巩固下前面所学的知识，达到学有所用的效果。另外本实验要求需要有 Go 语言的基础，对 Go 语言基本语法有一定的了解。

#### 知识点

- http 协议介绍
- web 工作方式
- 地址 URL 说明
- http 报文解析
- http 编程实现

## http 协议介绍

#### http 是什么

我们平时所说的 http 其实是指网络七层模型中应用层的 http 协议，也叫超文本传输协议（HTTP，HyperText Transfer Protocol)。既然是协议，那么它就是一种规范或者说是一种规则，它详细规定了浏览器和万维网服务器之间的相互通信。




通过使用网页浏览器、网络爬虫或者其它的工具，客户端发起一个 HTTP 请求到服务器上指定端口。我们称这个客户端为用户代理程序（user agent）。应答的服务器上存储着一些资源，比如 HTML 文件和图像。我们称这个应答服务器为源服务器（origin server）。在用户代理和源服务器中间可能存在多个“中间层”，比如代理服务器、网关或者隧道（tunnel）。所以如果要提高用户和源服务器之间的并发能力，一般是优化网关（比如 ngnix），或者使用隧道优化技术（比如 japronto）。

尽管 TCP/IP 协议是互联网上最流行的应用，HTTP 协议中，并没有规定必须使用它或它支持的层。事实上，HTTP 可以在任何互联网协议上，或其他网络上实现。HTTP 假定其下层协议提供可靠的传输。因此，任何能够提供这种保证的协议都可以被其使用。因此也就是其在 TCP/IP 协议族使用 TCP 作为其传输层。

通常，由 HTTP 客户端发起一个请求，创建一个到服务器指定端口（默认是 80 端口）的 TCP 连接。HTTP 服务器则在那个端口监听客户端的请求。一旦收到请求，服务器会向客户端返回一个状态，比如"HTTP/1.1 200 OK"，以及返回的内容，如请求的文件、错误消息、或者其它信息。


工作原理：
HTTP 协议定义 Web 客户端如何从 Web 服务器请求 Web 页面，以及服务器如何把 Web 页面传送给客户端。HTTP 协议采用了请求/响应模型。客户端向服务器发送一个请求报文，请求报文包含请求的方法、URL、协议版本、请求头部和请求数据。服务器以一个状态行作为响应，响应的内容包括协议的版本、成功或者错误代码、服务器信息、响应头部和响应数据。

以下是 HTTP 请求/响应的步骤：

客户端连接到 Web 服务器 一个 HTTP 客户端，通常是浏览器，与 Web 服务器的 HTTP 端口（默认为 80）建立一个 TCP 套接字连接。例如，http://www.luffycity.com。

发送 HTTP 请求 通过 TCP 套接字，客户端向 Web 服务器发送一个文本的请求（Request）报文，一个请求报文由请求行、请求头部、空行和请求数据 4 部分组成。

服务器接受请求并返回 HTTP 响应（Response） Web 服务器解析请求，定位请求资源。服务器将资源复本写到 TCP 套接字，由客户端读取。一个响应由状态行、响应头部、空行和响应数据 4 部分组成。

释放连接 TCP 连接 若 connection 模式为 close，则服务器主动关闭 TCP 连接，客户端被动关闭连接，释放 TCP 连接;若 connection 模式为 keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;

客户端浏览器解析 HTML 内容 客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的 HTML 文档和文档的字符集。客户端浏览器读取响应数据 HTML，根据 HTML 的语法对其进行格式化，并在浏览器窗口中显示。

例如：在浏览器地址栏键入 URL，按下回车之后会经历以下流程：

浏览器向 DNS 域名解析服务器（一般无需特别配置）请求解析该 URL 中的域名所对应的 IP 地址;

解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立 TCP 连接;

浏览器发出读取文件(URL 中域名后面部分对应的文件)的 HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;

服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;

释放 TCP 连接;

浏览器将该 html 文本解码并显示内容;

连接示意图如下：

我们可以看到，通常的 HTTP 协议中包括 TCP 的连接和断开以及传递报文的功能。TCP 协议在 HTTP 协议中起到传输层的作用。那么 HTTP 真正的严格定义就很清楚了，它是以网页浏览器为客户端，资源文件在服务器端，以 TCP/IP 为传输协议的一种通讯协议。它对应的套接字端口默认是 80。

## web 工作方式

## 地址 URL 说明

## http 报文解析

#### 请求报文解析

#### 响应报文解析

## http 编程实现（基于 Go 语言实现）

#### http 服务端实现

#### http 客户端实现

## 实验总结

以上是基于 Go 语言实现并发通讯服务的案例。通过学习完本实验，大家可以知道如何用 Go 语言的 Socket 编程来实现多用户（客户端）进行通讯了，其实大家可以理解为一个聊天室。后续如果能力可以的话，大家可以在该基础上，用 redis 数据库替换以上说到的客户端全局队列，实现用户的登录、注册以及用户在线列表等，学会举一反三，达到学有所用的效果。本实验代码相对前面实验来说比较简洁，实现流程也比较简单，其中最经典、也最值得学习的就是 Go 语言的协程（Goroutine），希望同学们可以理解到协程使用的精髓。
